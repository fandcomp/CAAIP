---
import BaseLayout from "~/layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const items = await getCollection('kabarDuka', ({ data }) => !data.draft && data.lang === 'id');
  return items.map((i) => ({ params: { slug: i.slug }, props: { item: i } }));
}

const { item } = Astro.props as { item: any };
const { Content } = await item.render();
---
<BaseLayout title={`Kabar Duka â€” ${item.data.name}`} description={item.data.message} lang="id">
  <!-- Google Fonts - Inter & Merriweather -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
  
  <section class="py-5" style="font-family: 'Inter', sans-serif; background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);">
    <div class="container-px mx-auto" style="max-width: 1000px;">
      <!-- Back Button -->
      <div class="mb-4">
        <a href="/kabar-duka" class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
          </svg>
          Kembali
        </a>
      </div>

      <!-- Main Card -->
      <div class="card border-0 shadow-lg overflow-hidden">
        <!-- Image Section - Full Width Hero -->
        {item.data.image && (
          <div class="position-relative" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); padding: 0;">
            <div style="position: relative; width: 100%; height: 500px; overflow: hidden;">
              <img 
                src={item.data.image} 
                alt={item.data.imageAlt || `Foto ${item.data.name}`}
                class="w-100 h-100"
                style="object-fit: cover; object-position: center; filter: brightness(0.85);"
              />
              <!-- Dark Overlay for Better Text Readability -->
              <div class="position-absolute" style="top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.6) 100%);"></div>
              
              <!-- Decorative Corner Ribbon -->
              <div class="position-absolute" style="top: 0; right: 0; width: 0; height: 0; border-style: solid; border-width: 0 80px 80px 0; border-color: transparent #000 transparent transparent; opacity: 0.4;"></div>
            </div>
          </div>
        )}

        <!-- Content Section -->
        <div class="card-body p-4 p-md-5">
          <!-- Header with Black Ribbon (if no image) -->
          {!item.data.image && (
            <div class="mb-4 pb-4 text-center" style="border-bottom: 3px solid #dee2e6;">
              <div class="d-inline-block px-4 py-2 mb-3" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: white; border-radius: 50px;">
                <small class="text-uppercase fw-semibold" style="letter-spacing: 1px;">Kabar Duka</small>
              </div>
            </div>
          )}

          <!-- Date Badge -->
          <div class="text-center mb-4">
            <div class="d-inline-flex align-items-center gap-2 px-3 py-2 rounded-pill" style="background: #f8f9fa; border: 1px solid #dee2e6;">
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="opacity: 0.6;">
                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
              </svg>
              <span class="small text-muted">{new Date(item.data.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</span>
            </div>
          </div>

          <!-- Name -->
          <div class="text-center mb-4">
            <h1 class="h2 fw-bold mb-2" style="font-family: 'Merriweather', serif; color: #1a1a1a;">
              {item.data.name}
            </h1>
            {item.data.relation && (
              <p class="text-muted mb-0" style="font-size: 1.1rem;">
                {item.data.relation}
              </p>
            )}
          </div>

          <!-- Decorative Divider -->
          <div class="text-center mb-4">
            <div class="d-inline-flex align-items-center gap-3">
              <div style="width: 60px; height: 1px; background: linear-gradient(to right, transparent, #dee2e6);"></div>
              <svg width="24" height="24" fill="#6c757d" viewBox="0 0 16 16" style="opacity: 0.4;">
                <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
              </svg>
              <div style="width: 60px; height: 1px; background: linear-gradient(to left, transparent, #dee2e6);"></div>
            </div>
          </div>

          <!-- Message Content -->
          {item.data.message && (
            <div class="mb-4">
              <div class="p-4 rounded-3" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-left: 4px solid #495057;">
                <p class="mb-0 text-dark" style="font-size: 1.1rem; line-height: 1.9; font-style: italic; text-align: center;">
                  "{item.data.message}"
                </p>
              </div>
            </div>
          )}

          <!-- Markdown Content -->
          <div class="prose prose-lg mx-auto" style="max-width: 720px;">
            <Content />
          </div>

          <!-- Decorative Divider -->
          <div class="text-center my-5">
            <div class="d-inline-flex align-items-center gap-3" style="opacity: 0.3;">
              <div style="width: 50px; height: 1px; background: #dee2e6;"></div>
              <div style="width: 8px; height: 8px; background: #dee2e6; border-radius: 50%; transform: rotate(45deg);"></div>
              <div style="width: 50px; height: 1px; background: #dee2e6;"></div>
            </div>
          </div>

          <!-- Footer Message -->
          <div class="text-center">
            <p class="text-muted mb-2" style="font-size: 0.95rem;">
              Turut berduka cita sedalam-dalamnya
            </p>
            <p class="fw-semibold mb-0" style="color: #1a1a1a; font-size: 1.05rem;">
              Keluarga Besar CAAIP
            </p>
          </div>
        </div>

        <!-- Bottom Accent -->
        <div style="height: 5px; background: linear-gradient(to right, #1a1a1a 0%, #495057 50%, #1a1a1a 100%);"></div>
      </div>

      <!-- Share Info -->
      <div class="text-center mt-4">
        <small class="text-muted fst-italic">
          Semoga amal ibadahnya diterima di sisi Allah SWT
        </small>
      </div>
    </div>
  </section>

  <style>
    /* Prose styling for markdown content */
    .prose {
      color: #374151;
      line-height: 1.8;
    }
    
    .prose h1, .prose h2, .prose h3 {
      font-family: 'Merriweather', serif;
      color: #1f2937;
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    
    .prose h1 { font-size: 2rem; }
    .prose h2 { font-size: 1.5rem; }
    .prose h3 { font-size: 1.25rem; }
    
    .prose p {
      margin-bottom: 1.5rem;
      text-align: justify;
    }
    
    .prose a {
      color: #3b82f6;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.2s;
    }
    
    .prose a:hover {
      border-bottom-color: #3b82f6;
    }
    
    .prose img {
      border-radius: 0.75rem;
      margin: 2rem 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .prose blockquote {
      border-left: 4px solid #e5e7eb;
      padding-left: 1.5rem;
      font-style: italic;
      color: #6b7280;
      margin: 2rem 0;
    }

    .prose ul, .prose ol {
      margin-bottom: 1.5rem;
      padding-left: 2rem;
    }

    .prose li {
      margin-bottom: 0.5rem;
    }
  </style>
</BaseLayout>
